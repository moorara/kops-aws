name: Main
on: push
jobs:
  terraform:
    name: Terraform
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - name: Set Terraform Variables
        shell: bash
        env:
          AWS_ACCESS_KEY: ${{ secrets.AWS_ACCESS_KEY }}
          AWS_SECRET_KEY: ${{ secrets.AWS_SECRET_KEY }}
        run: |
          echo "access_key = \"$AWS_ACCESS_KEY\"" > infra-terraform/terraform.tfvars
          echo "secret_key = \"$AWS_SECRET_KEY\"" >> infra-terraform/terraform.tfvars
          echo 'region = "us-east-1"' >> infra-terraform/terraform.tfvars
          echo 'environment = "test"' >> infra-terraform/terraform.tfvars
          echo 'domain = "example.com"' >> infra-terraform/terraform.tfvars
          echo 'keybase_username = "username"' >> infra-terraform/terraform.tfvars

          # echo "access_key       = \"$AWS_ACCESS_KEY\""  >  infra-terraform/terraform.tfvars
          # echo "secret_key       = \"$AWS_SECRET_KEY\""  >> infra-terraform/terraform.tfvars
          # echo 'region           = "us-east-1"'          >> infra-terraform/terraform.tfvars
          # echo 'environment      = "test"'               >> infra-terraform/terraform.tfvars
          # echo 'domain           = "example.com"'        >> infra-terraform/terraform.tfvars
          # echo 'keybase_username = "username"'           >> infra-terraform/terraform.tfvars
      - name: Terraform Validate
        shell: bash
        run: |
          # terraform is available in the GitHub Actions virtual environment
          cd infra-terraform
          cat terraform.tfvars
          make init validate
